"use strict";(()=>{var O=Object.create;var g=Object.defineProperty;var B=Object.getOwnPropertyDescriptor;var L=Object.getOwnPropertyNames;var w=Object.getPrototypeOf,P=Object.prototype.hasOwnProperty;var U=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),T=(t,e)=>{for(var n in e)g(t,n,{get:e[n],enumerable:!0})},M=(t,e,n,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of L(e))!P.call(t,s)&&s!==n&&g(t,s,{get:()=>e[s],enumerable:!(r=B(e,s))||r.enumerable});return t};var D=(t,e,n)=>(n=t!=null?O(w(t)):{},M(e||!t||!t.__esModule?g(n,"default",{value:t,enumerable:!0}):n,t));var v=(t,e,n)=>new Promise((r,s)=>{var o=a=>{try{c(n.next(a))}catch(p){s(p)}},i=a=>{try{c(n.throw(a))}catch(p){s(p)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(o,i);c((n=n.apply(t,e)).next())});var k=U(()=>{"use strict";(()=>{var t=s=>decodeURIComponent(escape(s)),e=s=>s.replace(/\r\n|\r/g,`
`),n=class extends EventTarget{constructor(s,o){super(),this.CONNECTING=0,this.OPEN=1,this.CLOSED=2,this.withCredentials=!1,this.headers={},this.lastEventId="",this.reconnectionTime=2e3,this.responseTextCursor=0,this.eventTypeBuffer="",this.idBuffer="",this.dataBuffer="",this.canReconnect=!0,this.url=s,this.withCredentials=Boolean(o&&o.withCredentials),o&&o.headers&&(this.headers=o.headers),this.addEventListener("error",i=>{this.onerror&&this.onerror(i)}),this.addEventListener("message",i=>{this.onmessage&&this.onmessage(i)}),this.addEventListener("open",i=>{this.onopen&&this.onopen(i)}),this.connect()}announceConnection(){this.readyState=this.OPEN,this.dispatchEvent(new Event("open")),this.responseTextCursor=0}connect(s=this.url){this.readyState=this.CONNECTING;let o=this.xhr=new XMLHttpRequest;o.open("GET",s,!0);for(let i in this.headers)o.setRequestHeader(i,this.headers[i]);o.setRequestHeader("Accept","text/event-stream"),o.setRequestHeader("Cache-Control","no-cache"),this.lastEventId&&o.setRequestHeader("Last-Event-ID",this.lastEventId),o.onreadystatechange=()=>{if(!(o.readyState<=1||this.readyState===this.CLOSED)){if(o.readyState===4){this.reestablishConnection();return}switch(o.status){case 200:this.handleConnection(o),this.interpretStream(o);break;case 204:this.canReconnect=!1;break;case 301:case 307:let i=o.getResponseHeader("Location");this.failConnection(o,!0),i&&this.connect(i);break;default:this.failConnection(o)}}},o.send()}dispatchMessageEvent(s){if(this.lastEventId=this.idBuffer,this.dataBuffer===""){this.eventTypeBuffer="";return}this.dataBuffer[this.dataBuffer.length-1]===`
`&&(this.dataBuffer=this.dataBuffer.slice(0,-1));let o=this.eventTypeBuffer||"message",i=new MessageEvent(o,{data:this.dataBuffer,origin:s,lastEventId:this.lastEventId});this.eventTypeBuffer="",this.dataBuffer="",this.dispatchEvent(i)}handleConnection(s){if(this.readyState===this.CONNECTING){let o=s.getResponseHeader("Content-Type");o&&o.toLowerCase()==="text/event-stream"?this.announceConnection():this.failConnection(s)}}failConnection(s,o=!1){this.readyState=this.CLOSED,o||this.dispatchEvent(new Event("error")),this.canReconnect=!1,s.abort()}interpretStream(s){if(this.readyState!==this.OPEN)return;let o="";try{o=s.responseText}catch(a){return}let i=o.substring(this.responseTextCursor);this.responseTextCursor=o.length;let c=e(t(i)).split(`
`);for(let a=0;a<c.length;a++){let p=c[a];if(p==="")this.dispatchMessageEvent(s.responseURL);else{let h=p.indexOf(":");if(h!==0)if(h!==-1){let A=p.substring(0,h),y=p.substring(h+1),N=y.indexOf(" ")===0?y.slice(1):y;this.processField({field:A,value:N})}else this.processField({field:p,value:""})}}}processField(s){switch(s.field){case"event":this.eventTypeBuffer=s.value;break;case"data":this.dataBuffer+=`${s.value}
`;break;case"id":s.value.indexOf("\0")===-1&&(this.idBuffer=s.value);break;case"retry":let o=+s.value;Number.isInteger(o)&&(this.reconnectionTime=o)}}reestablishConnection(){this.readyState===this.CLOSED||!this.canReconnect||(this.readyState=this.CONNECTING,this.dispatchEvent(new Event("error")),setTimeout(()=>{this.readyState===this.CONNECTING&&this.connect()},this.reconnectionTime))}close(){this.readyState=this.CLOSED,this.xhr&&this.xhr.abort()}},r=n;window.EventSourceWithHeaders=r})()});var f={};T(f,{default:()=>G,del:()=>H,get:()=>u,post:()=>d,postFormData:()=>R,stringify_query:()=>j});var m;function x(t){m=t}function l(t,e){let n=m+t;return console.log(["fetch_url",n]),fetch(n,e).then(s=>v(this,null,function*(){switch(console.log(s),s.status){case 200:return s.json();default:return s.json().then(o=>({error:!0,status:s.status,body:o}))}}))}function u(t,e){let n={Accept:"application/json","Content-Type":"application/json"};return e.session_token&&(n["X-Access-Token"]=e.session_token),l(t,{headers:n})}function d(t,e,n){let r=n?JSON.stringify(n):"null",s={Accept:"application/json","Content-Type":"application/json"};return e.session_token&&(s["X-Access-Token"]=e.session_token),l(t,{method:"POST",body:r,headers:s})}function H(t,e){let n={Accept:"application/json","Content-Type":"application/json"};return e.session_token&&(n["X-Access-Token"]=e.session_token),l(t,{method:"DELETE",headers:n})}function R(t,e,n){return v(this,null,function*(){let r={Accept:"application/json"};return e.session_token&&(r["X-Access-Token"]=e.session_token),l(t,{method:"POST",body:n,headers:r})})}function _(t,e,n){n!=null&&t.push([encodeURIComponent(e),encodeURIComponent(n)])}var C=class{constructor(e){this.params=e}url_encode(){let e=[];for(let n in this.params){let r=this.params[n];if(r!==null){if(typeof r=="string"||typeof r=="number"||typeof r=="boolean"){_(e,n,r.toString());continue}if(Array.isArray(r)){if(r.length>0&&(typeof r[0]=="string"||typeof r[0]=="number"||typeof r[0]=="boolean")){_(e,n,r.join(","));continue}throw"url_encode not implemented for "+typeof r+" "+JSON.stringify(r)}if(typeof r=="object"&&r.hasOwnProperty("url_encode"))for(let[s,o]of r.url_encode())e.push([`${n}.${s}`,o]);throw"url_encode not implemented for "+typeof r+" "+JSON.stringify(r)}}return e}};function j(t){let e=new C(t).url_encode();return console.log(["stringify_query",e]),e.length>0?`?${e.map(([n,r])=>`${n}=${r}`).join("&")}`:""}var G={get:u,post:d,postFormData:R};var I={};var E={};T(E,{get_connection_events:()=>F,get_conversation_events:()=>q,mark_read:()=>Q,send_message:()=>$,start_typing:()=>J,stop_typing:()=>X});function F(t){return u("/events",t)}function q(t,e){return u(`/conversation/${e}/events`,t)}function $(t,e,n){return d(`/conversation/${e}`,t,n)}function J(t,e,n){return d(`/conversation/${e}/start-typing`,t,n)}function X(t,e,n){return d(`/conversation/${e}/stop-typing`,t,n)}function Q(t,e){return d("/read",t,e)}var S=D(k()),W={EventSourceWithHeaders:S.default,init:x,Types:I,Endpoints:E,Utils:f},b=W;window.ChatteliteClient=b;})();
//# sourceMappingURL=chattelite-client.min.js.map
